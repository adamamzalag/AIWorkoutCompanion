| ‼️ Priority | File location / snippet                                                                                                                                                                  | Why it matters                                                                                                                                                         | Quick fix                                                                                                                                                                                                     |
| ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **High**    | **`generateWorkoutPlan` example JSON**<br>`"weight": null for bodyweight or "15 lbs" for weighted`<br>`"equipment": ["none"] or ["dumbbells"]`                                           | Those in-line comments make the example **invalid JSON**; models sometimes echo them and `JSON.parse` will explode.                                                    | Replace with two valid examples *above* the snippet, then leave only legal JSON inside the block:<br>`"weight": null,`                                                                                        |
| **High**    | **`parseJSONWithRetry` helper** is **never called**                                                                                                                                      | You still `JSON.parse` directly in every function, so the retry logic never runs.                                                                                      | Wrap each risky `JSON.parse` in `parseJSONWithRetry(...)`. Example: `const result = await parseJSONWithRetry(response.choices[0].message.content, () => openai.chat.completions.create({...retryPrompt...}))` |
| **High**    | **`WORKOUT_STRUCTURE_RULES`** vs. **weekly prompt schema**                                                                                                                               | The rules show `warmUp`/`coolDown` *outside* `exercises`, but the earlier mini-schema under the rules shows `exercises` only. Mixed guidance can lead to schema drift. | Decide on one canonical shape and make every prompt + rule match it.                                                                                                                                          |
| **Med**     | `JSON_RESPONSE_RULES` says *“No keys outside the specified structure.”* yet some prompts append optional fields like `tempo`, `modifications`, `progressions`.                           | Guards contradict examples—model may drop optional keys when you want them.                                                                                            | Either add those keys to the spec or move them to “optional but allowed” bullet.                                                                                                                              |
| **Med**     | `generateDailyCoachingTip` switches to **`gpt-4o-mini`** while everything else uses 4.1-mini.                                                                                            | Fine if intentional; just be sure you really want a different model (prices & behavior differ).                                                                        |                                                                                                                                                                                                               |
| **Med**     | `Available Equipment: ${JSON.stringify(request.equipment)}`<br> renders `["db","bb"]` in the prompt. Double-quotes inside the string rarely break anything, but a few models strip them. | Safer: `Available Equipment: ${request.equipment.join(", ")}`                                                                                                          |                                                                                                                                                                                                               |
| **Low**     | `WORKOUT_STRUCTURE_RULES` block still contains bullet “Follow the exact schema” *and* shows a schematic JSON. This bloats tokens every call.                                             | Optionally move that big block to the **system** message once and keep weekly prompts slim.                                                                            |                                                                                                                                                                                                               |
| **Low**     | Tiny typo: “###REFERENCE SCHEMA###” line is good, but you forgot the trailing notice “Do not include above reference in output.”                                                         | Add it to reduce the chance the model copies the schema into its answer.                                                                                               |                                                                                                                                                                                                               |
| **Low**     | In some prompts you embed `JSON.stringify(userGoals.join(", "))` — unnecessary `join` before `JSON.stringify`.                                                                           | Use one or the other (I’d stringify the array).                                                                                                                        |                                                                                                                                                                                                               |
